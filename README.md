# üé¨ Shorts Maker API

FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Ä–µ–∑–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ —à–æ—Ä—Ç—Å—ã —Å –º–æ–±–∏–ª—å–Ω–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Ä–µ–∑–∫–∞** –≤–∏–¥–µ–æ –ø–æ —Å—Ü–µ–Ω–∞–º –∏ –ø–∞—É–∑–∞–º
- **–ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è** –≤ —Ñ–æ—Ä–º–∞—Ç 9:16 —Å —Ä–∞–∑–º—ã—Ç—ã–º —Ñ–æ–Ω–æ–º
- **–°—É–±—Ç–∏—Ç—Ä—ã** —Å –ø–æ–º–æ—â—å—é Whisper AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **–ì–∏–±–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - PostgreSQL –∏–ª–∏ JSON —Ñ–∞–π–ª—ã
- **Docker Ready** - –≥–æ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# Windows
start_local.bat

# Linux/Mac
chmod +x start_local.sh
./start_local.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Docker —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f shorts-maker-api

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
cp .env.local .env  # –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ –ë–î
# –∏–ª–∏
cp .env.docker .env  # –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

# –ó–∞–ø—É—Å–∫
uvicorn app.main:app --reload
```

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:

### –†–µ–∂–∏–º JSON —Ñ–∞–π–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–æ–∫–∞–ª—å–Ω–æ)
- `USE_DATABASE=false`
- –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–∞–π–ª–∞—Ö
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î

### –†–µ–∂–∏–º PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Docker)
- `USE_DATABASE=true`
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- –ì–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:

```env
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
USE_DATABASE=false          # true –¥–ª—è PostgreSQL, false –¥–ª—è JSON

# API
API_HOST=0.0.0.0
API_PORT=8000

# –ü—É—Ç–∏
UPLOAD_PATH=./storage/input
OUTPUT_PATH=./storage/output
TEMP_PATH=./storage/temp

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ USE_DATABASE=true)
DB_HOST=localhost
DB_NAME=shorts_maker
DB_USER=shorts_user
DB_PASSWORD=shorts_password_2024

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ
MIN_DURATION_DEFAULT=60     # –ú–∏–Ω. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞
MAX_DURATION_DEFAULT=180    # –ú–∞–∫—Å. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞
MOBILE_SCALE_DEFAULT=1.2    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è
```

## üì° API Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `POST` | `/api/v1/process` | –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ |
| `GET` | `/api/v1/status/{task_id}` | –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ |
| `GET` | `/api/v1/download/{file_path}` | –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ |
| `GET` | `/api/v1/algorithms` | –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã |
| `GET` | `/api/v1/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è |

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
curl -X POST "http://localhost:8000/api/v1/process" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@video.mp4" \
  -F "min_duration=60" \
  -F "max_duration=180"

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl "http://localhost:8000/api/v1/status/task_1699123456_abc12345"

# 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
curl -O "http://localhost:8000/api/v1/download/task_1699123456_abc12345/video_part_01.mp4"
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ main.py                 # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ api/routes/             # API —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ core/                   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ algorithms/             # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–∞—Ä–µ–∑–∫–∏
‚îú‚îÄ‚îÄ database/               # –ú–æ–¥—É–ª–∏ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ models/                 # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ services/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ config/                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
- Python 3.8+
- FFmpeg (–≤ PATH)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- PostgreSQL (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- Docker & Docker Compose

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FFmpeg

**Windows:**
1. –°–∫–∞—á–∞–π—Ç–µ —Å https://ffmpeg.org/download.html
2. –î–æ–±–∞–≤—å—Ç–µ –≤ PATH

**Linux:**
```bash
sudo apt install ffmpeg
```

**macOS:**
```bash
brew install ffmpeg
```

## üê≥ Docker

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
```bash
docker build -t shorts-maker-api .
docker run -p 8000:8000 -v $(pwd)/storage:/app/storage shorts-maker-api
```

### –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –° –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ API
docker-compose up -d --scale shorts-maker-api=3
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ò–∑–æ–ª—è—Ü–∏—è –ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Health check**: `/api/v1/health`
- **–õ–æ–≥–∏**: –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ñ–∞–π–ª—ã
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: `/api/v1/stats`
- **–ú–µ—Ç—Ä–∏–∫–∏**: –≥–æ—Ç–æ–≤ –¥–ª—è Prometheus

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–∞–º–∏

API –≥–æ—Ç–æ–≤ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram/Discord –±–æ—Ç–∞–º–∏:

```python
import requests

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
response = requests.post(
    "http://localhost:8000/api/v1/process",
    files={"file": open("video.mp4", "rb")},
    data={"min_duration": 60, "max_duration": 180}
)

task_id = response.json()["task_id"]

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
while True:
    status = requests.get(f"http://localhost:8000/api/v1/status/{task_id}")
    if status.json()["status"] == "completed":
        break
    time.sleep(5)
```

## üìù Changelog

### v1.0.0
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä–µ–∑–∫–∏ –≤–∏–¥–µ–æ
- FastAPI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ JSON —Ä–µ–∂–∏–º–æ–≤
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –≤–∏–¥–µ–æ

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: FFmpeg –Ω–µ –Ω–∞–π–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ FFmpeg –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `USE_DATABASE=false`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License